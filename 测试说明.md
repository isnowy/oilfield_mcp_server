# 快速测试说明

## 🚀 一键测试

### 测试不同角色的权限差异

```powershell
# 双击运行（Windows）
.\run_role_test.bat
```

或

```powershell
# PowerShell
$env:DEV_MODE="false"
python test_role_permissions.py
```

**测试内容**：自动验证 admin、engineer、viewer、default 四个角色的 36 个权限测试用例。

---

## 📋 测试脚本说明

| 脚本名称 | 用途 | 使用场景 |
|---------|------|---------|
| `run_role_test.bat` | 一键运行角色权限测试 | 快速验证权限控制 |
| `test_role_permissions.py` | 自动化角色权限测试 | 详细测试所有角色 |
| `test_librechat_setup.ps1` | 生成 LibreChat 测试配置 | LibreChat 环境测试 |
| `test_permissions.py` | 基础权限逻辑测试 | 验证权限检查函数 |
| `test_server.py` | 功能测试 | 验证所有工具函数 |

---

## 🎯 快速测试流程

### 步骤 1: 验证基础功能

```powershell
python test_server.py
```

确认所有 13 个功能测试通过。

### 步骤 2: 测试角色权限

```powershell
.\run_role_test.bat
```

查看 36 个权限测试是否全部通过。

### 步骤 3: 测试 LibreChat 集成

```powershell
.\test_librechat_setup.ps1
```

按照提示将配置复制到 LibreChat，然后在浏览器中测试。

---

## ✅ 预期结果

### Python 自动化测试

```
================================================================================
  📊 测试总结
================================================================================
  总测试数: 36
  ✅ 通过: 36
  ❌ 失败: 0
  📈 通过率: 100.0%
================================================================================

🎉 所有测试通过！权限控制正常工作。
```

### LibreChat 测试

| 查询 | admin | engineer | viewer | default |
|------|-------|----------|--------|---------|
| ZT-102 井 | ✅ | ✅ | ✅ | ❌ |
| ZT-105 井 | ✅ | ✅ | ❌ | ❌ |
| XY-009 井 | ✅ | ❌ | ❌ | ❌ |
| Block-A | ✅ | ✅ | ✅ | ❌ |
| Block-B | ✅ | ❌ | ❌ | ❌ |

---

## 📚 详细文档

- [角色权限测试指南.md](md/角色权限测试指南.md) - 完整测试指南
- [部署启动指南.md](md/部署启动指南.md) - 部署和配置
- [README_PERMISSIONS.md](md/README_PERMISSIONS.md) - 权限控制说明

---

## 🐛 遇到问题？

### 测试失败

```powershell
# 1. 检查是否为生产模式
$env:DEV_MODE="false"

# 2. 重新安装依赖
pip install -r requirements.txt

# 3. 运行基础测试
python test_server.py
```

### LibreChat 无法识别

1. 检查配置文件路径
2. 验证 YAML 格式
3. 完全重启 LibreChat
4. 查看后台日志

---

**提示**：测试前确保 `DEV_MODE=false`，否则所有角色都会有 admin 权限！

**最后更新**：2026-01-27
