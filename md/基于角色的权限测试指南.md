# åŸºäºè§’è‰²çš„æƒé™æµ‹è¯•æŒ‡å—

## æƒé™æ¨¡å‹ï¼ˆå·²æ›´æ–°ï¼‰

### ğŸ”„ å˜æ›´è¯´æ˜
æƒé™æ§åˆ¶å·²ä»**åŸºäºç”¨æˆ·ID**æ”¹ä¸º**åŸºäºè§’è‰²**ï¼š
- âœ… ä¸å†ä¾èµ–ç”¨æˆ·IDåŒ¹é…
- âœ… å®Œå…¨åŸºäºç”¨æˆ·è§’è‰²ï¼ˆADMIN/ENGINEER/VIEWER/USER/GUESTï¼‰
- âœ… é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰æ¯ä¸ªè§’è‰²å¯è®¿é—®çš„äº•åˆ—è¡¨

### è§’è‰²æƒé™è¯´æ˜

| è§’è‰² | å¯è®¿é—®äº•å· | è¯´æ˜ |
|------|-----------|------|
| **ADMIN** | æ‰€æœ‰äº•ï¼ˆ4å£ï¼‰ | ç®¡ç†å‘˜ï¼Œå®Œå…¨è®¿é—®æƒé™ |
| **ENGINEER** | ZT-102, ZT-105 + å…¬å…±æ•°æ®(ZT-108) | å·¥ç¨‹å¸ˆï¼ŒBlock-Açš„éƒ¨åˆ†äº• |
| **VIEWER** | ZT-102 + å…¬å…±æ•°æ®(ZT-108) | æŸ¥çœ‹è€…ï¼Œåªè¯»æƒé™ |
| **USER** | ä»…å…¬å…±æ•°æ®(ZT-108) | æ™®é€šç”¨æˆ· |
| **GUEST** | ä»…å…¬å…±æ•°æ®(ZT-108) | è®¿å®¢ |

### æµ‹è¯•æ•°æ®

| äº•å· | äº•å | æ‰€æœ‰è€… | è¯´æ˜ |
|------|------|--------|------|
| ZT-102 | ä¸­å¡”-102 | user1@test.com | åˆ†é…ç»™ENGINEER/VIEWER |
| ZT-105 | ä¸­å¡”-105 | user2@test.com | åˆ†é…ç»™ENGINEER |
| ZT-108 | ä¸­å¡”-108 | None | å…¬å…±æ•°æ®ï¼Œæ‰€æœ‰è§’è‰²å¯è§ |
| XY-009 | æ–°ç–†-009 | user1@test.com | ä»…ADMINå¯è§ |

## æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: PowerShell æµ‹è¯•

#### æµ‹è¯•1: ADMIN ç®¡ç†å‘˜ï¼ˆåº”è¯¥çœ‹åˆ°æ‰€æœ‰4å£äº•ï¼‰
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "X-User-Role" = "ADMIN"
    "X-User-Email" = "admin@test.com"
    "X-User-ID" = "admin123"
}
$body = @{
    name = "search_wells"
    arguments = @{
        keyword = ""
        status = "All"
    }
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/mcp/call-tool" -Method Post -Headers $headers -Body $body
```
**é¢„æœŸç»“æœ**: è¿”å›4å£äº•ï¼ˆZT-102, ZT-105, ZT-108, XY-009ï¼‰

#### æµ‹è¯•2: ENGINEER å·¥ç¨‹å¸ˆï¼ˆåº”è¯¥çœ‹åˆ°3å£äº•ï¼‰
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "X-User-Role" = "ENGINEER"
    "X-User-Email" = "engineer@test.com"
    "X-User-ID" = "engineer123"
}
$body = @{
    name = "search_wells"
    arguments = @{
        keyword = ""
        status = "All"
    }
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/mcp/call-tool" -Method Post -Headers $headers -Body $body
```
**é¢„æœŸç»“æœ**: è¿”å›3å£äº•ï¼ˆZT-102, ZT-105, ZT-108ï¼‰

#### æµ‹è¯•3: VIEWER æŸ¥çœ‹è€…ï¼ˆåº”è¯¥çœ‹åˆ°2å£äº•ï¼‰
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "X-User-Role" = "VIEWER"
    "X-User-Email" = "viewer@test.com"
    "X-User-ID" = "viewer123"
}
$body = @{
    name = "search_wells"
    arguments = @{
        keyword = ""
        status = "All"
    }
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/mcp/call-tool" -Method Post -Headers $headers -Body $body
```
**é¢„æœŸç»“æœ**: è¿”å›2å£äº•ï¼ˆZT-102, ZT-108ï¼‰

#### æµ‹è¯•4: USER æ™®é€šç”¨æˆ·ï¼ˆåº”è¯¥åªçœ‹åˆ°1å£å…¬å…±äº•ï¼‰
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "X-User-Role" = "USER"
    "X-User-Email" = "user@test.com"
    "X-User-ID" = "user123"
}
$body = @{
    name = "search_wells"
    arguments = @{
        keyword = ""
        status = "All"
    }
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/mcp/call-tool" -Method Post -Headers $headers -Body $body
```
**é¢„æœŸç»“æœ**: è¿”å›1å£äº•ï¼ˆZT-108å…¬å…±æ•°æ®ï¼‰

#### æµ‹è¯•5: GUEST è®¿å®¢ï¼ˆåº”è¯¥åªçœ‹åˆ°1å£å…¬å…±äº•ï¼‰
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "X-User-Role" = "GUEST"
    "X-User-Email" = "guest@test.com"
    "X-User-ID" = "guest123"
}
$body = @{
    name = "search_wells"
    arguments = @{
        keyword = ""
        status = "All"
    }
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/mcp/call-tool" -Method Post -Headers $headers -Body $body
```
**é¢„æœŸç»“æœ**: è¿”å›1å£äº•ï¼ˆZT-108å…¬å…±æ•°æ®ï¼‰

### æ–¹æ³•2: curl æµ‹è¯•

#### ADMIN æµ‹è¯•
```bash
curl -X POST http://localhost:8080/mcp/call-tool \
  -H "Content-Type: application/json" \
  -H "X-User-Role: ADMIN" \
  -H "X-User-Email: admin@test.com" \
  -H "X-User-ID: admin123" \
  -d '{"name":"search_wells","arguments":{"keyword":"","status":"All"}}'
```

#### USER æµ‹è¯•
```bash
curl -X POST http://localhost:8080/mcp/call-tool \
  -H "Content-Type: application/json" \
  -H "X-User-Role: USER" \
  -H "X-User-Email: user@test.com" \
  -H "X-User-ID: user123" \
  -d '{"name":"search_wells","arguments":{"keyword":"","status":"All"}}'
```

### æ–¹æ³•3: é€šè¿‡ LibreChat

1. ä½¿ç”¨ä¸åŒè§’è‰²çš„è´¦å·ç™»å½•LibreChat
2. ç¡®ä¿LibreChatä¼ é€’æ­£ç¡®çš„X-User-Role header
3. è°ƒç”¨MCPå·¥å…·æŸ¥è¯¢æ•°æ®
4. éªŒè¯è¿”å›ç»“æœç¬¦åˆè§’è‰²æƒé™

## æƒé™é…ç½®è¯´æ˜

æƒé™é…ç½®åœ¨ä»£ç ä¸­çš„ `USER_PERMISSIONS` å­—å…¸ï¼š

```python
USER_PERMISSIONS = {
    "ADMIN": {
        "wells": "*",           # "*" è¡¨ç¤ºæ‰€æœ‰äº•
        "blocks": "*",
        "role": "admin",
        "description": "ç®¡ç†å‘˜ - å®Œå…¨è®¿é—®æƒé™"
    },
    "ENGINEER": {
        "wells": ["ZT-102", "ZT-105"],  # æŒ‡å®šäº•åˆ—è¡¨
        "blocks": ["Block-A"],
        "role": "engineer",
        "description": "å·¥ç¨‹å¸ˆ - Block-Açš„éƒ¨åˆ†äº• + å…¬å…±æ•°æ®"
    },
    "USER": {
        "wells": [],            # ç©ºåˆ—è¡¨ = ä»…å…¬å…±æ•°æ®
        "blocks": [],
        "role": "user",
        "description": "æ™®é€šç”¨æˆ· - ä»…å…¬å…±æ•°æ®"
    }
}
```

### è‡ªå®šä¹‰æƒé™

è¦ä¿®æ”¹è§’è‰²æƒé™ï¼Œç¼–è¾‘é…ç½®ï¼š

**ç»™USERè§’è‰²æ·»åŠ ç‰¹å®šäº•çš„è®¿é—®æƒé™ï¼š**
```python
"USER": {
    "wells": ["ZT-102"],  # æ·»åŠ å¯è®¿é—®çš„äº•
    "blocks": ["Block-A"],
    "role": "user",
    "description": "æ™®é€šç”¨æˆ· - ZT-102 + å…¬å…±æ•°æ®"
}
```

**åˆ›å»ºæ–°è§’è‰²ï¼š**
```python
"OPERATOR": {
    "wells": ["XY-009"],
    "blocks": ["Block-B"],
    "role": "operator",
    "description": "æ“ä½œå‘˜ - Block-Bçš„äº•"
}
```

## æœåŠ¡å™¨æ—¥å¿—

### å¼€å‘æ¨¡å¼æ—¥å¿—
```
ğŸ”“ å¼€å‘æ¨¡å¼ï¼šç”¨æˆ· user@test.com (USER) è®¿é—®æ‰€æœ‰æ•°æ®
```

### ç”Ÿäº§æ¨¡å¼æ—¥å¿—

**ADMINç”¨æˆ·ï¼š**
```
âœ… ADMINç”¨æˆ· admin@test.com è®¿é—®æ‰€æœ‰ 4 å£äº•
```

**USERç”¨æˆ·ï¼š**
```
ğŸ”’ USERç”¨æˆ· user@test.com è®¿é—® 1/4 å£äº•ï¼ˆä»…å…¬å…±æ•°æ®ï¼‰
```

**ENGINEERç”¨æˆ·ï¼š**
```
ğŸ”’ ENGINEERç”¨æˆ· engineer@test.com è®¿é—® 3/4 å£äº•ï¼ˆæƒé™é…ç½®+å…¬å…±æ•°æ®ï¼‰
```

## æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] ADMIN èƒ½çœ‹åˆ°æ‰€æœ‰4å£äº•
- [ ] ENGINEER èƒ½çœ‹åˆ°3å£äº•ï¼ˆZT-102, ZT-105, ZT-108ï¼‰
- [ ] VIEWER èƒ½çœ‹åˆ°2å£äº•ï¼ˆZT-102, ZT-108ï¼‰
- [ ] USER åªèƒ½çœ‹åˆ°1å£å…¬å…±äº•ï¼ˆZT-108ï¼‰
- [ ] GUEST åªèƒ½çœ‹åˆ°1å£å…¬å…±äº•ï¼ˆZT-108ï¼‰
- [ ] USERå°è¯•è®¿é—®ZT-102è¯¦æƒ…è¢«æ‹’ç»ï¼ˆå¦‚æœæ²¡æœ‰åœ¨æƒé™é…ç½®ä¸­ï¼‰
- [ ] æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ç¡®è®¤æƒé™è¿‡æ»¤æ­£å¸¸å·¥ä½œ

## åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼

å½“å‰é»˜è®¤æ˜¯å¼€å‘æ¨¡å¼ï¼Œè¦å¯ç”¨çœŸå®æƒé™æ§åˆ¶ï¼š

### æ–¹æ³•1: ç¯å¢ƒå˜é‡
```powershell
$env:DEV_MODE="false"
python oilfield_mcp_http_server.py
```

### æ–¹æ³•2: ä¿®æ”¹ä»£ç 
åœ¨ `oilfield_mcp_http_server.py` ç¬¬54è¡Œï¼š
```python
# æ”¹ä¸ºï¼š
DEV_MODE = os.getenv("DEV_MODE", "false").lower() in ["true", "1", "yes"]
```

## é¢„æœŸç»“æœå¯¹ç…§è¡¨

| æ“ä½œ | ADMIN | ENGINEER | VIEWER | USER | GUEST |
|------|-------|----------|--------|------|-------|
| æœç´¢æ‰€æœ‰äº• | 4å£äº• | 3å£äº• | 2å£äº• | 1å£äº• | 1å£äº• |
| æŸ¥çœ‹ZT-102 | âœ… | âœ… | âœ… | âŒ | âŒ |
| æŸ¥çœ‹ZT-105 | âœ… | âœ… | âŒ | âŒ | âŒ |
| æŸ¥çœ‹ZT-108 | âœ… | âœ… | âœ… | âœ… | âœ… |
| æŸ¥çœ‹XY-009 | âœ… | âŒ | âŒ | âŒ | âŒ |

æ³¨ï¼šâŒ è¡¨ç¤ºæƒé™è¢«æ‹’ç»æˆ–åœ¨æœç´¢ç»“æœä¸­è¢«è¿‡æ»¤

## å¸¸è§é—®é¢˜

### Q: ç”¨æˆ·IDè¿˜æœ‰ç”¨å—ï¼Ÿ
A: ç”¨æˆ·IDç°åœ¨ä¸»è¦ç”¨äºæ—¥å¿—è®°å½•å’Œå®¡è®¡ï¼Œä¸å†ç”¨äºæƒé™åˆ¤æ–­ã€‚æƒé™å®Œå…¨åŸºäºè§’è‰²ã€‚

### Q: å¦‚ä½•è®©USERè§’è‰²è®¿é—®ç‰¹å®šçš„äº•ï¼Ÿ
A: åœ¨USER_PERMISSIONSä¸­ä¸ºUSERè§’è‰²æ·»åŠ äº•åˆ—è¡¨ï¼š
```python
"USER": {
    "wells": ["ZT-102", "ZT-108"],  # æŒ‡å®šå¯è®¿é—®çš„äº•
    ...
}
```

### Q: å…¬å…±æ•°æ®æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Ÿ
A: äº•çš„ `owner_user_id` å­—æ®µä¸º `None` çš„æ•°æ®è¢«è§†ä¸ºå…¬å…±æ•°æ®ï¼Œæ‰€æœ‰è§’è‰²éƒ½å¯ä»¥è®¿é—®ã€‚

### Q: å¯ä»¥ä¸ºä¸åŒç”¨æˆ·åˆ†é…ä¸åŒçš„æƒé™å—ï¼Ÿ
A: å½“å‰åŸºäºè§’è‰²ï¼Œæ‰€æœ‰ç›¸åŒè§’è‰²çš„ç”¨æˆ·æƒé™ç›¸åŒã€‚å¦‚éœ€ä¸ºæ¯ä¸ªç”¨æˆ·å•ç‹¬é…ç½®ï¼Œå¯ä»¥æ‰©å±•ä»£ç æ”¯æŒç”¨æˆ·çº§æƒé™é…ç½®ã€‚

## æ€»ç»“

âœ… æƒé™æ§åˆ¶å·²æ”¹ä¸ºåŸºäºè§’è‰²  
âœ… ä¸å†ä¾èµ–ç”¨æˆ·IDåŒ¹é…  
âœ… é€šè¿‡USER_PERMISSIONSé…ç½®è§’è‰²æƒé™  
âœ… æ”¯æŒäº•çº§åˆ«çš„ç»†ç²’åº¦æ§åˆ¶  
âœ… å…¬å…±æ•°æ®æ‰€æœ‰è§’è‰²å¯è§  
âœ… çµæ´»çš„æƒé™é…ç½®å’Œæ‰©å±•  

æŒ‰ç…§æœ¬æŒ‡å—æµ‹è¯•ï¼Œç¡®ä¿ä¸åŒè§’è‰²çš„è®¿é—®æƒé™ç¬¦åˆé¢„æœŸã€‚
