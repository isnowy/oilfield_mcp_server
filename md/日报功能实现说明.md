# ä¸‰ä¸ªæ—¥æŠ¥åŠŸèƒ½å®ç°è¯´æ˜

## æ¦‚è¿°

å·²æˆåŠŸå°†ä¸‰ä¸ªæ—¥æŠ¥çš„æŸ¥è¯¢æ–¹æ³•é›†æˆåˆ° `oilfield_mcp_true_server.py` MCP Server ä¸­ã€‚æ”¯æŒé€šè¿‡ HTTP/SSE æ–¹å¼è°ƒç”¨è¿™äº›å·¥å…·ã€‚

## æ–°å¢å·¥å…·åˆ—è¡¨

### 1. ğŸ”¨ é’»äº•å·¥ç¨‹æ—¥æŠ¥æŸ¥è¯¢ (`get_drilling_daily`)
**æè¿°**: æŸ¥è¯¢é’»äº•å·¥ç¨‹æ—¥æŠ¥æ•°æ® - æ”¯æŒæŒ‰äº•å·ã€æ—¥æœŸèŒƒå›´æŸ¥è¯¢

**å‚æ•°**:
- `well_id` (string): äº•å· - å¯é€‰
- `start_date` (string): å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰- å¯é€‰
- `end_date` (string): ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰- å¯é€‰
- `limit` (integer): è¿”å›ç»“æœæ•°é‡é™åˆ¶ - é»˜è®¤100

**æ•°æ®è¡¨**: `drilling_daily`

**è¿”å›å­—æ®µ**:
- æ—¥æœŸã€äº•å·ã€å½“æ—¥äº•æ·±ã€æ—¥è¿›å°ºã€é’»å¤´ç±»å‹ã€é’»é€Ÿã€æ³µå‹ã€é’»äº•æ¶²å¯†åº¦ç­‰

**ä½¿ç”¨ç¤ºä¾‹**:
```json
{
  "well_id": "ZT-102",
  "start_date": "2024-01-01",
  "end_date": "2024-01-31",
  "limit": 50
}
```

---

### 2. ğŸ—ï¸ é’»å‰å·¥ç¨‹æ—¥æŠ¥æŸ¥è¯¢ (`get_drilling_pre_daily`)
**æè¿°**: æŸ¥è¯¢é’»å‰å·¥ç¨‹æ—¥æŠ¥æ•°æ® - æ”¯æŒæŒ‰é¡¹ç›®ã€å¹´åº¦ã€äº•å·æŸ¥è¯¢

**å‚æ•°**:
- `project` (string): å‹˜æ¢é¡¹ç›®åç§° - å¯é€‰
- `year` (integer): å®æ–½å¹´åº¦ - å¯é€‰
- `well_id` (string): äº•å· - å¯é€‰
- `limit` (integer): è¿”å›ç»“æœæ•°é‡é™åˆ¶ - é»˜è®¤50

**æ•°æ®è¡¨**: `drilling_pre_daily`

**è¿”å›å­—æ®µ**:
- äº•å·ã€é¡¹ç›®ã€å¹´åº¦ã€äº•ä½è®ºè¯ã€å·¥ç¨‹è®¾è®¡å®¡æ‰¹ã€ç¯è¯„ä¸‹è¾¾ã€æ¬å®¶å®‰è£…ç­‰å…³é”®æ—¶é—´èŠ‚ç‚¹

**ä½¿ç”¨ç¤ºä¾‹**:
```json
{
  "project": "AåŒºå—å‹˜æ¢é¡¹ç›®",
  "year": 2024,
  "limit": 20
}
```

---

### 3. â›½ é‡ç‚¹äº•è¯•é‡‡æ—¥æŠ¥æŸ¥è¯¢ (`get_key_well_daily`)
**æè¿°**: æŸ¥è¯¢é‡ç‚¹äº•è¯•é‡‡æ—¥æŠ¥æ•°æ® - æ”¯æŒæŒ‰äº•å·ã€æ—¥æœŸèŒƒå›´ã€åŒºå—æŸ¥è¯¢ï¼ŒåŒ…æ‹¬ç”Ÿäº§æ•°æ®å’Œå‹åŠ›å‚æ•°

**å‚æ•°**:
- `well_id` (string): äº•å· - å¯é€‰
- `start_date` (string): å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰- å¯é€‰
- `end_date` (string): ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰- å¯é€‰
- `block` (string): åŒºå—åç§° - å¯é€‰
- `limit` (integer): è¿”å›ç»“æœæ•°é‡é™åˆ¶ - é»˜è®¤100

**æ•°æ®è¡¨**: `key_well_daily`

**è¿”å›å­—æ®µ**:
- æ—¥æœŸã€äº•å·ã€åŒºå—ã€å±‚ä½ã€çŠ¶æ€ã€æ—¥äº§æ°”é‡ã€å«æ°´ç‡ã€æ²¹å˜´ã€å‹åŠ›å‚æ•°
- å‹åŠ›å‚æ•°åŒ…æ‹¬: æ²¹å‹ä¸Šä¸‹é™ã€å¥—å‹ä¸Šä¸‹é™ã€å›å‹ä¸Šä¸‹é™ã€æµå‹ã€é™å‹

**ä½¿ç”¨ç¤ºä¾‹**:
```json
{
  "well_id": "ZT-102",
  "start_date": "2024-01-01",
  "block": "Block-A",
  "limit": 100
}
```

---

## åŠŸèƒ½ç‰¹æ€§

âœ… **æƒé™æ§åˆ¶**
- æ‰€æœ‰å·¥å…·éƒ½æ”¯æŒåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- å¼€å‘æ¨¡å¼ï¼ˆDEV_MODE=trueï¼‰å¯è·³è¿‡æƒé™æ£€æŸ¥
- ç”Ÿäº§æ¨¡å¼ï¼ˆDEV_MODE=falseï¼‰ä¸¥æ ¼éªŒè¯ç”¨æˆ·æƒé™

âœ… **å®¡è®¡æ—¥å¿—**
- ä½¿ç”¨ `@AuditLog.trace()` è£…é¥°å™¨è®°å½•æ‰€æœ‰å·¥å…·è°ƒç”¨
- è®°å½•å…¥å‚ã€å‡ºå‚ã€æ‰§è¡Œæ—¶é—´ã€ç”¨æˆ·ä¿¡æ¯ã€çŠ¶æ€ç­‰

âœ… **é”™è¯¯å¤„ç†**
- å®Œæ•´çš„å¼‚å¸¸æ•è·å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- è¯¦ç»†çš„æ—¥å¿—è®°å½•ä¾¿äºé—®é¢˜è¯Šæ–­

âœ… **æ•°æ®æ ¼å¼åŒ–**
- ä½¿ç”¨ Markdown è¡¨æ ¼æ ¼å¼å±•ç¤ºæ•°æ®
- ç»“æ„åŒ–è¾“å‡ºä¾¿äº LLM å’Œå®¢æˆ·ç«¯è§£æ

âœ… **çµæ´»æŸ¥è¯¢**
- æ”¯æŒå¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢ï¼ˆAND é€»è¾‘ï¼‰
- æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œç²¾ç¡®åŒ¹é…
- æ”¯æŒæ—¥æœŸèŒƒå›´æŸ¥è¯¢

---

## é›†æˆæ–¹å¼

### åœ¨ MCP Server ä¸­æ³¨å†Œå·¥å…·

å·¥å…·å·²åœ¨ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹æ³¨å†Œï¼š

1. **`@mcp_server.list_tools()`** - MCP æ ‡å‡†æ¥å£
2. **POST `/sse` ç«¯ç‚¹** - æ— çŠ¶æ€ JSON-RPC æ–¹å¼

### è°ƒç”¨å·¥å…·

#### æ–¹å¼1: é€šè¿‡ MCP å®¢æˆ·ç«¯è°ƒç”¨
```python
# è°ƒç”¨é’»äº•å·¥ç¨‹æ—¥æŠ¥
result = await client.call_tool(
    name="get_drilling_daily",
    arguments={
        "well_id": "ZT-102",
        "start_date": "2024-01-01",
        "end_date": "2024-01-31"
    }
)
```

#### æ–¹å¼2: é€šè¿‡ HTTP POST è°ƒç”¨
```bash
curl -X POST http://localhost:8081/sse \
  -H "Content-Type: application/json" \
  -H "x-user-role: ADMIN" \
  -H "x-user-email: admin@example.com" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "tools/call",
    "params": {
      "name": "get_drilling_daily",
      "arguments": {
        "well_id": "ZT-102",
        "start_date": "2024-01-01"
      }
    }
  }'
```

---

## æ•°æ®åº“è¡¨ä¾èµ–

```sql
-- ä¸‰ä¸ªæ—¥æŠ¥è¡¨å¿…é¡»å­˜åœ¨äº PostgreSQL æ•°æ®åº“ä¸­
- drilling_daily        -- é’»äº•å·¥ç¨‹æ—¥æŠ¥
- drilling_pre_daily    -- é’»å‰å·¥ç¨‹æ—¥æŠ¥
- key_well_daily        -- é‡ç‚¹äº•è¯•é‡‡æ—¥æŠ¥
```

è¯¦è§:
- [drilling_daily_schema.sql](drilling_daily_schema.sql)
- [drilling_pre_daily_schema.sql](drilling_pre_daily_schema.sql)
- [key_well_daily_schema.sql](key_well_daily_schema.sql)

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æŸ¥è¯¢æŸäº•æœ€è¿‘ä¸€å‘¨çš„é’»äº•è¿›åº¦
```json
{
  "method": "tools/call",
  "params": {
    "name": "get_drilling_daily",
    "arguments": {
      "well_id": "ZT-102",
      "start_date": "2024-02-20",
      "end_date": "2024-02-27"
    }
  }
}
```

### åœºæ™¯2: æŸ¥è¯¢æŸé¡¹ç›®çš„é’»å‰è¿›åº¦
```json
{
  "method": "tools/call",
  "params": {
    "name": "get_drilling_pre_daily",
    "arguments": {
      "project": "BåŒºå—å‹˜æ¢",
      "year": 2024
    }
  }
}
```

### åœºæ™¯3: æŸ¥è¯¢æŸåŒºå—é‡ç‚¹äº•çš„ç”Ÿäº§æ•°æ®
```json
{
  "method": "tools/call",
  "params": {
    "name": "get_key_well_daily",
    "arguments": {
      "block": "Block-A",
      "start_date": "2024-02-01"
    }
  }
}
```

---

## æ–‡ä»¶ä¿®æ”¹æ±‡æ€»

### ä¿®æ”¹ä½ç½®
- `oilfield_mcp_true_server.py` - ç¬¬ 1 å¤„ (ä¸»æ–‡ä»¶)

### ä¿®æ”¹å†…å®¹
1. âœ… åœ¨ POST `/sse` ç«¯ç‚¹çš„å·¥å…·åˆ—è¡¨ä¸­æ·»åŠ  3 ä¸ªæ–°å·¥å…·å®šä¹‰
2. âœ… åœ¨ POST `/sse` ç«¯ç‚¹çš„å·¥å…·è°ƒç”¨å¤„ç†ä¸­æ·»åŠ  3 ä¸ªæ–°å·¥å…·çš„è°ƒç”¨é€»è¾‘
3. âœ… åœ¨ `@mcp_server.list_tools()` ä¸­æ·»åŠ  3 ä¸ªæ–°å·¥å…·å®šä¹‰
4. âœ… åœ¨ `@mcp_server.call_tool()` ä¸­æ·»åŠ  3 ä¸ªæ–°å·¥å…·çš„è°ƒç”¨é€»è¾‘
5. âœ… å®ç° 3 ä¸ªä¸šåŠ¡é€»è¾‘å‡½æ•°:
   - `get_drilling_daily()` - é’»äº•å·¥ç¨‹æ—¥æŠ¥æŸ¥è¯¢
   - `get_drilling_pre_daily()` - é’»å‰å·¥ç¨‹æ—¥æŠ¥æŸ¥è¯¢
   - `get_key_well_daily()` - é‡ç‚¹äº•è¯•é‡‡æ—¥æŠ¥æŸ¥è¯¢

---

## è¯­æ³•éªŒè¯

âœ… Python è¯­æ³•æ£€æŸ¥é€šè¿‡
âœ… æ‰€æœ‰å‡½æ•°æ­£ç¡®å¯¼å…¥å’Œå®ç°
âœ… æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢é€»è¾‘å®Œæ•´

---

## åç»­æ‰©å±•

å¯ä»¥è¿›ä¸€æ­¥æ·»åŠ :
- ğŸ“Š æ•°æ®åˆ†æå’Œç»Ÿè®¡èšåˆåŠŸèƒ½
- ğŸ“ˆ è¶‹åŠ¿åˆ†æï¼ˆé’»é€Ÿå˜åŒ–ã€æ—¥è¿›å°ºå¯¹æ¯”ç­‰ï¼‰
- ğŸ”” æ•°æ®å¼‚å¸¸å‘Šè­¦
- ğŸ“¤ æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆCSVã€Excelï¼‰
- ğŸ“Š å¯è§†åŒ–å›¾è¡¨æ¨è

