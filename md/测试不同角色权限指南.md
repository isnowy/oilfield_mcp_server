# æµ‹è¯•ä¸åŒè§’è‰²æƒé™æŒ‡å—

## æ¦‚è¿°

MCP æœåŠ¡å™¨å·²é›†æˆåŸºäºç”¨æˆ·IDå’Œè§’è‰²çš„æƒé™æ§åˆ¶ã€‚æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•æµ‹è¯•ä¸åŒè§’è‰²çš„æ•°æ®è®¿é—®æƒé™ã€‚

## æƒé™æ¨¡å‹

### æ•°æ®æ‰€æœ‰æƒè§„åˆ™
- **ADMIN è§’è‰²**: å¯ä»¥è®¿é—®æ‰€æœ‰äº•çš„æ•°æ®
- **å…¶ä»–è§’è‰²**: åªèƒ½è®¿é—®ï¼š
  - è‡ªå·±æ‹¥æœ‰çš„äº•ï¼ˆowner_user_id åŒ¹é…ï¼‰
  - å…¬å…±æ•°æ®ï¼ˆowner_user_id ä¸º Noneï¼‰

### æµ‹è¯•æ•°æ®é…ç½®

| äº•å· | äº•å | æ‰€æœ‰è€… | æ‰€æœ‰è€…é‚®ç®± | å¤‡æ³¨ |
|------|------|--------|-----------|------|
| ZT-102 | ä¸­å¡”-102 | 697c0cbebb4a93216518c3f9 | user1@test.com | User1çš„äº• |
| ZT-105 | ä¸­å¡”-105 | 697c0cbebb4a93216518c3fd | user2@test.com | User2çš„äº• |
| ZT-108 | ä¸­å¡”-108 | None | None | å…¬å…±æ•°æ® |
| XY-009 | æ–°ç–†-009 | 697c0cbebb4a93216518c3f9 | user1@test.com | User1çš„äº• |

## æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: é€šè¿‡ LibreChat æµ‹è¯•ï¼ˆæ¨èï¼‰

#### æ­¥éª¤1: ç¡®ä¿ LibreChat æ­£ç¡®é…ç½®

åœ¨ LibreChat çš„é…ç½®ä¸­ï¼ˆ`librechat.yaml`ï¼‰ï¼Œç¡®ä¿ MCP æœåŠ¡å™¨é…ç½®åŒ…å«ç”¨æˆ·ä¿¡æ¯ä¼ é€’ï¼š

```yaml
endpoints:
  agents:
    disableBuilder: false
    mcp:
      oilfield:
        url: "http://localhost:8080/sse"
        transport: "sse"
        auth: false
```

#### æ­¥éª¤2: å¯åŠ¨ MCP æœåŠ¡å™¨

```bash
# Windows
python oilfield_mcp_http_server.py

# æˆ–ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶
start_http_server.bat
```

#### æ­¥éª¤3: ç™»å½•ä¸åŒè§’è‰²ç”¨æˆ·æµ‹è¯•

##### æµ‹è¯•åœºæ™¯1: ADMIN ç”¨æˆ·
**ç”¨æˆ·ä¿¡æ¯**:
- Role: ADMIN
- Email: admin@test.com
- User ID: admin123

**é¢„æœŸç»“æœ**: å¯ä»¥çœ‹åˆ°æ‰€æœ‰4å£äº•ï¼ˆZT-102, ZT-105, ZT-108, XY-009ï¼‰

**æµ‹è¯•å‘½ä»¤**:
```
æœç´¢æ‰€æœ‰äº•
```

##### æµ‹è¯•åœºæ™¯2: User1 ï¼ˆæ™®é€šç”¨æˆ·ï¼‰
**ç”¨æˆ·ä¿¡æ¯**:
- Role: USER
- Email: user1@test.com
- User ID: 697c0cbebb4a93216518c3f9

**é¢„æœŸç»“æœ**: åªèƒ½çœ‹åˆ°3å£äº•
- ZT-102 (è‡ªå·±çš„)
- XY-009 (è‡ªå·±çš„)
- ZT-108 (å…¬å…±æ•°æ®)

**æµ‹è¯•å‘½ä»¤**:
```
æœç´¢æ‰€æœ‰äº•
æŸ¥è¯¢ZT-102çš„ä¿¡æ¯
æŸ¥è¯¢ZT-105çš„ä¿¡æ¯  # åº”è¯¥è¢«æ‹’ç»
```

##### æµ‹è¯•åœºæ™¯3: User2 ï¼ˆæ™®é€šç”¨æˆ·ï¼‰
**ç”¨æˆ·ä¿¡æ¯**:
- Role: USER
- Email: user2@test.com
- User ID: 697c0cbebb4a93216518c3fd

**é¢„æœŸç»“æœ**: åªèƒ½çœ‹åˆ°2å£äº•
- ZT-105 (è‡ªå·±çš„)
- ZT-108 (å…¬å…±æ•°æ®)

**æµ‹è¯•å‘½ä»¤**:
```
æœç´¢æ‰€æœ‰äº•
æŸ¥è¯¢ZT-105çš„ä¿¡æ¯
æŸ¥è¯¢ZT-102çš„ä¿¡æ¯  # åº”è¯¥è¢«æ‹’ç»
```

### æ–¹æ³•2: ç›´æ¥é€šè¿‡ HTTP API æµ‹è¯•

#### ä½¿ç”¨ curl æµ‹è¯•

##### ADMIN ç”¨æˆ·æµ‹è¯•
```bash
curl -X POST http://localhost:8080/mcp/call-tool \
  -H "Content-Type: application/json" \
  -H "X-User-Role: ADMIN" \
  -H "X-User-Email: admin@test.com" \
  -H "X-User-ID: admin123" \
  -d '{
    "name": "search_wells",
    "arguments": {
      "keyword": "",
      "status": "All"
    }
  }'
```

##### User1 æµ‹è¯•
```bash
curl -X POST http://localhost:8080/mcp/call-tool \
  -H "Content-Type: application/json" \
  -H "X-User-Role: USER" \
  -H "X-User-Email: user1@test.com" \
  -H "X-User-ID: 697c0cbebb4a93216518c3f9" \
  -d '{
    "name": "search_wells",
    "arguments": {
      "keyword": "",
      "status": "All"
    }
  }'
```

##### User2 æµ‹è¯•
```bash
curl -X POST http://localhost:8080/mcp/call-tool \
  -H "Content-Type: application/json" \
  -H "X-User-Role: USER" \
  -H "X-User-Email: user2@test.com" \
  -H "X-User-ID: 697c0cbebb4a93216518c3fd" \
  -d '{
    "name": "search_wells",
    "arguments": {
      "keyword": "",
      "status": "All"
    }
  }'
```

##### æµ‹è¯•æƒé™æ‹’ç»ï¼ˆUser1å°è¯•è®¿é—®User2çš„äº•ï¼‰
```bash
curl -X POST http://localhost:8080/mcp/call-tool \
  -H "Content-Type: application/json" \
  -H "X-User-Role: USER" \
  -H "X-User-Email: user1@test.com" \
  -H "X-User-ID: 697c0cbebb4a93216518c3f9" \
  -d '{
    "name": "get_well_summary",
    "arguments": {
      "well_id": "ZT-105"
    }
  }'
```

**é¢„æœŸå“åº”**: åº”è¯¥è¿”å›æƒé™æ‹’ç»ä¿¡æ¯

### æ–¹æ³•3: ä½¿ç”¨ Postman æµ‹è¯•

#### é…ç½® Postman Collection

1. **åˆ›å»ºç¯å¢ƒå˜é‡**:
   - `base_url`: http://localhost:8080
   - `admin_role`: ADMIN
   - `admin_email`: admin@test.com
   - `admin_id`: admin123
   - `user1_role`: USER
   - `user1_email`: user1@test.com
   - `user1_id`: 697c0cbebb4a93216518c3f9

2. **åˆ›å»ºè¯·æ±‚**: POST `{{base_url}}/mcp/call-tool`

3. **è®¾ç½® Headers**:
   - Content-Type: application/json
   - X-User-Role: {{admin_role}}
   - X-User-Email: {{admin_email}}
   - X-User-ID: {{admin_id}}

4. **è¯·æ±‚ Body**:
```json
{
  "name": "search_wells",
  "arguments": {
    "keyword": "",
    "status": "All"
  }
}
```

5. **åˆ‡æ¢ç”¨æˆ·**: ä¿®æ”¹ Headers ä¸­çš„ç¯å¢ƒå˜é‡å³å¯æµ‹è¯•ä¸åŒç”¨æˆ·

## éªŒè¯æ—¥å¿—è¾“å‡º

### æœåŠ¡å™¨æ—¥å¿—å…³é”®ä¿¡æ¯

å¯åŠ¨æœåŠ¡å™¨åï¼Œå…³æ³¨ä»¥ä¸‹æ—¥å¿—ï¼š

```
============================================================
ğŸ“‹ æå–ç”¨æˆ·ä¸Šä¸‹æ–‡
  è§’è‰²: USER
  é‚®ç®±: user1@test.com
  ç”¨æˆ·ID: 697c0cbebb4a93216518c3f9
============================================================
```

æ‰§è¡Œå·¥å…·æ—¶çš„æ—¥å¿—ï¼š
```
ğŸ”§ HTTPå·¥å…·è°ƒç”¨: search_wells | ç”¨æˆ·: USER
ğŸ“ å‚æ•°: {"keyword": "", "status": "All"}
ğŸ‘¤ è°ƒç”¨ç”¨æˆ·: user1@test.com (USER)
ğŸ”’ ç”¨æˆ· user1@test.com (USER) è®¿é—® 3/4 å£äº•
âœ… å·¥å…·æ‰§è¡ŒæˆåŠŸ: search_wells
```

## å¼€å‘æ¨¡å¼

### è·³è¿‡æƒé™æ£€æŸ¥ï¼ˆè°ƒè¯•ç”¨ï¼‰

è®¾ç½®ç¯å¢ƒå˜é‡å¯ç”¨å¼€å‘æ¨¡å¼ï¼š

```bash
# Windows PowerShell
$env:DEV_MODE="true"
python oilfield_mcp_http_server.py

# Windows CMD
set DEV_MODE=true
python oilfield_mcp_http_server.py
```

**å¼€å‘æ¨¡å¼ç‰¹ç‚¹**:
- æ‰€æœ‰ç”¨æˆ·å¯ä»¥è®¿é—®æ‰€æœ‰æ•°æ®
- æ—¥å¿—ä¸­æ˜¾ç¤º "ğŸ”“ å¼€å‘æ¨¡å¼ï¼šç”¨æˆ· xxx è®¿é—®æ‰€æœ‰æ•°æ®"
- é€‚åˆè°ƒè¯•å’Œå¼€å‘é˜¶æ®µ

### ç”Ÿäº§æ¨¡å¼

```bash
# Windows PowerShell
$env:DEV_MODE="false"
python oilfield_mcp_http_server.py

# æˆ–è€…åˆ é™¤ç¯å¢ƒå˜é‡ï¼ˆé»˜è®¤falseï¼‰
Remove-Item Env:DEV_MODE
```

## é¢„æœŸæµ‹è¯•ç»“æœæ€»ç»“

| ç”¨æˆ·è§’è‰² | User ID | å¯è®¿é—®äº•å· | è¢«æ‹’ç»äº•å· |
|---------|---------|-----------|-----------|
| ADMIN | admin123 | ZT-102, ZT-105, ZT-108, XY-009 | æ—  |
| USER (user1) | 697c0cbebb4a93216518c3f9 | ZT-102, ZT-108, XY-009 | ZT-105 |
| USER (user2) | 697c0cbebb4a93216518c3fd | ZT-105, ZT-108 | ZT-102, XY-009 |
| GUEST | any | ZT-108 (ä»…å…¬å…±æ•°æ®) | ZT-102, ZT-105, XY-009 |

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½çœ‹åˆ°æ‰€æœ‰æ•°æ®

**åŸå› **: DEV_MODE å¯èƒ½è¢«è®¾ç½®ä¸º true

**è§£å†³**: 
```bash
$env:DEV_MODE="false"
# é‡å¯æœåŠ¡å™¨
```

### é—®é¢˜2: è¯·æ±‚å¤´æ²¡æœ‰ä¼ é€’åˆ°æœåŠ¡å™¨

**ç—‡çŠ¶**: æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤º "ç”¨æˆ·è§’è‰²: GUEST"

**æ£€æŸ¥**:
1. LibreChat é…ç½®æ˜¯å¦æ­£ç¡®è®¾ç½®äº† MCP æœåŠ¡å™¨
2. LibreChat æ˜¯å¦æ­£ç¡®ä¼ é€’äº†ç”¨æˆ·ä¿¡æ¯
3. æŸ¥çœ‹ LibreChat çš„æ—¥å¿—ç¡®è®¤è¯·æ±‚å¤´

### é—®é¢˜3: æƒé™è¿‡æ»¤ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥**:
1. æ•°æ®åº“ä¸­ owner_user_id å­—æ®µæ˜¯å¦æ­£ç¡®è®¾ç½®
2. ç”¨æˆ·ä¼ é€’çš„ user_id æ˜¯å¦ä¸æ•°æ®åº“åŒ¹é…
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ä¸­çš„æƒé™è¿‡æ»¤ä¿¡æ¯

## æ‰©å±•æ•°æ®æ·»åŠ ä¸åŒç”¨æˆ·

å¦‚æœéœ€è¦æ·»åŠ æ›´å¤šæµ‹è¯•æ•°æ®ï¼Œä¿®æ”¹ `seed_mock_data()` å‡½æ•°ï¼š

```python
Well(
    id="NEW-001",
    name="æ–°äº•-001",
    block="Block-C",
    target_depth=4800,
    spud_date=date(2024, 1, 1),
    status="Active",
    well_type="Horizontal",
    team="Team-999",
    rig="Rig-99",
    owner_user_id="your_user_id_here",  # è®¾ç½®æ‰€æœ‰è€…
    owner_email="newuser@test.com"
)
```

## æ€»ç»“

æƒé™æ§åˆ¶å·²å®Œå…¨é›†æˆåˆ° MCP æœåŠ¡å™¨ä¸­ï¼š

âœ… æ•°æ®åº“æ¨¡å‹æ”¯æŒæ‰€æœ‰è€…å­—æ®µ  
âœ… HTTP headers æå–ç”¨æˆ·ä¿¡æ¯  
âœ… æƒé™è¿‡æ»¤å‡½æ•°åŸºäºç”¨æˆ·IDå’Œè§’è‰²  
âœ… æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å‡½æ•°åº”ç”¨æƒé™æ£€æŸ¥  
âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•ä¾¿äºè°ƒè¯•  
âœ… å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼åˆ‡æ¢  

æŒ‰ç…§æœ¬æŒ‡å—æµ‹è¯•ï¼Œç¡®ä¿ä¸åŒè§’è‰²çš„ç”¨æˆ·åªèƒ½è®¿é—®å…¶æœ‰æƒé™çš„æ•°æ®ã€‚
