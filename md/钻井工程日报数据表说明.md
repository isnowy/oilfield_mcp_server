# 钻井工程日报数据表设计与导入说明

## 一、数据表设计

### 表名：`drilling_daily`

### 字段设计

| 字段名 | 数据类型 | 说明 | 对应Excel列 |
|--------|----------|------|-------------|
| id | SERIAL | 主键ID | - |
| rq | DATE | 日期 | RQ |
| jh | VARCHAR(50) | 井号（关联oil_wells.well_name） | JH |
| kzrq | DATE | 开钻日期 | KZRQ |
| drjs | DECIMAL(10,2) | 当日井深（米） | DRJS |
| zjrjc | DECIMAL(10,2) | 日进尺（米） | ZJRJC |
| ztlx | VARCHAR(50) | 钻头类型 | ZTLX |
| ztzj | DECIMAL(10,2) | 钻头直径（毫米） | ZTZJ |
| zy | DECIMAL(10,2) | 钻压（千牛） | ZY |
| zs | DECIMAL(10,2) | 钻速（米/小时） | ZS |
| bya | DECIMAL(10,2) | 泵压（兆帕） | BYA |
| bpl | DECIMAL(10,2) | 排量（升/秒） | BPL |
| zjymd | DECIMAL(10,2) | 钻井液密度（克/立方厘米） | ZJYMD |
| zjynd | DECIMAL(10,2) | 钻井液粘度（秒） | ZJYND |
| czjljsj | DECIMAL(10,2) | 纯钻进累计时间（小时） | CZJLJSJ |
| brzygz | TEXT | 本日主要工作 | BRZYGZ |
| created_at | TIMESTAMP | 创建时间 | - |
| updated_at | TIMESTAMP | 更新时间 | - |
| is_deleted | BOOLEAN | 软删除标记 | - |

### 索引设计

- 主键索引：id
- 单列索引：jh, rq, kzrq, created_at, is_deleted
- 复合索引：(jh, rq)

### 设计说明

1. **井号字段（jh）**：关联oil_wells表的well_name字段。部分井号可以匹配，部分无法匹配。

2. **日期字段**：rq为必填，kzrq允许为空。

3. **钻井参数**：包含完整的钻井工艺参数（井深、进尺、钻压、钻速等）。

4. **钻头信息**：记录钻头类型和直径。

5. **钻井液参数**：记录密度和粘度。

## 二、数据导入情况

### 导入统计

- **Excel总行数**：85,513 行（去除2行表头）
- **有效数据行**：81,751 行（井号和日期都不为空）
- **已导入记录数**：81,751 条
- **不同井号数**：2,296 个
- **日期范围**：2020-01-01 至 2023-10-25

### 数据过滤说明

导入时过滤了以下记录：
- 完全空白的行：约74行
- 井号为空的行：3,762行（包括完全空白的行和仅井号为空的3行）
- 日期格式错误的行：已在清洗时处理

**导入原则**：只导入井号和日期都不为空的记录

### 井号匹配情况

#### 井号匹配统计
- **匹配成功的井号**：384 个（16.7%）
- **匹配失败的井号**：1,912 个（83.3%）

#### 记录数匹配统计
- **总记录数**：81,751 条
- **匹配成功**：24,225 条（29.6%）
- **匹配失败**：57,526 条（70.4%）

### 匹配失败的主要井号（Top 10）

| 井号 | 记录数 |
|------|--------|
| MaHWTRRW | 293 条 |
| JLHWPRO | 279 条 |
| DXHWOPOO | 275 条 |
| MaHWTRVS | 274 条 |
| JLHWPTO | 273 条 |
| DXHWQUWS | 242 条 |
| DXHWQUTP | 233 条 |
| MaHWTRTQ | 231 条 |
| MaHWTPPP | 225 条 |
| MaHWTRVW | 224 条 |

### 匹配成功的主要井号（Top 10）

| 井号 | 记录数 | 区块 | 井型 |
|------|--------|------|------|
| 乐探Q | 540 条 | 一厂探区 | 直井 |
| GHW00Q | 380 条 | 一厂探区 | 直井 |
| 呼探Q | 354 条 | 呼探1 | 直井 |
| 天湾Q | 344 条 | - | 直井 |
| 天安Q | 343 条 | 一厂探区 | 直井 |
| 高Q0O | 283 条 | - | 直井 |
| 康探P | 248 条 | 准东探区 | 直井 |
| 台TT | 246 条 | 准东探区 | 直井 |
| 石南R0Q | 244 条 | 石西探区 | 直井 |
| A页P | 242 条 | - | 直井 |

### 按年份统计

| 年份 | 总记录数 | 匹配记录数 | 匹配率 |
|------|---------|-----------|--------|
| 2020 | 48,429 | 14,798 | 30.6% |
| 2021 | 32,078 | 8,936 | 27.9% |
| 2022 | 1,228 | 488 | 39.7% |
| 2023 | 16 | 3 | 18.8% |

## 三、相关文件

### 1. 建表SQL脚本
**文件**：`drilling_daily_schema.sql`

包含完整的表结构定义、索引创建、字段注释和触发器。

### 2. 数据导入脚本
**文件**：`import_drilling_daily.py`

**功能**：
- 读取drilling_daily.xlsx文件
- 数据清洗和验证
- 自动创建表（如果不存在）
- 批量导入数据到PostgreSQL
- 检查井号与oil_wells表的匹配情况

**使用方法**：
```bash
python import_drilling_daily.py
```

### 3. 匹配报告脚本
**文件**：`drilling_matching_report.py`

**功能**：
- 生成详细的井号匹配报告
- 统计匹配成功/失败的井号和记录数
- 按年份、井号等维度分析数据

**使用方法**：
```bash
python drilling_matching_report.py
```

## 四、使用示例

### 查询示例

```sql
-- 1. 查询某井的钻井日报数据
SELECT * FROM drilling_daily 
WHERE jh = '乐探Q' 
ORDER BY rq DESC;

-- 2. 关联oil_wells表查询完整信息
SELECT d.jh, d.rq, d.drjs, d.zjrjc, d.brzygz,
       o.qk, o.cw, o.jx
FROM drilling_daily d
INNER JOIN oil_wells o ON d.jh = o.well_name
WHERE d.jh = '乐探Q'
ORDER BY d.rq DESC;

-- 3. 统计每口井的钻井进度
SELECT jh, 
       MIN(rq) as 开始日期,
       MAX(rq) as 最后日期,
       MAX(drjs) as 最终井深,
       SUM(zjrjc) as 累计进尺,
       COUNT(*) as 钻井天数
FROM drilling_daily
WHERE drjs IS NOT NULL
GROUP BY jh
ORDER BY 最终井深 DESC
LIMIT 10;

-- 4. 查询某时间段的钻井统计
SELECT 
    DATE_TRUNC('month', rq) as 月份,
    COUNT(DISTINCT jh) as 钻井数,
    SUM(zjrjc) as 总进尺,
    AVG(zjrjc) as 平均日进尺
FROM drilling_daily
WHERE rq BETWEEN '2021-01-01' AND '2021-12-31'
  AND zjrjc > 0
GROUP BY DATE_TRUNC('month', rq)
ORDER BY 月份;

-- 5. 分析钻井工艺参数
SELECT jh,
       AVG(zy) as 平均钻压,
       AVG(zs) as 平均钻速,
       AVG(bya) as 平均泵压,
       AVG(zjymd) as 平均钻井液密度
FROM drilling_daily
WHERE zy IS NOT NULL AND zs IS NOT NULL
GROUP BY jh
HAVING COUNT(*) > 100
ORDER BY 平均钻速 DESC
LIMIT 10;

-- 6. 查询能关联到oil_wells的记录
SELECT d.*, o.qk, o.cw, o.jx
FROM drilling_daily d
INNER JOIN oil_wells o ON d.jh = o.well_name
WHERE d.rq >= '2022-01-01'
ORDER BY d.rq DESC
LIMIT 20;
```

## 五、注意事项

1. **井号匹配率较低**：只有29.6%的记录能匹配到oil_wells表，这可能是因为：
   - drilling_daily中使用的井号编码体系与oil_wells不完全一致
   - 部分井未录入到oil_wells基础数据表
   - 井号命名规范不统一

2. **数据时间范围**：数据集中在2020-2021年（占98.5%），2022年后的数据较少。

3. **匹配成功的井**：主要是探井（如乐探Q、呼探Q、天湾Q等），这些井的数据质量较好。

4. **使用建议**：
   - 查询时优先使用能匹配到oil_wells的井号
   - 对于无法匹配的井号，可以单独分析drilling_daily表中的数据
   - 建议后续建立井号映射表，统一不同数据源的井号编码

## 六、后续优化建议

1. **建立井号映射表**：统一drilling_daily和oil_wells的井号编码体系
2. **补充oil_wells数据**：将drilling_daily中的井号信息补充到oil_wells表
3. **数据质量检查**：
   - 检查异常的钻井参数值
   - 验证日进尺与井深的逻辑关系
   - 清理重复或错误的记录
4. **添加数据验证规则**：
   - 井深应递增
   - 日进尺应为正数
   - 钻井参数应在合理范围内
5. **创建统计分析视图**：为常用的统计查询创建视图或物化视图
